<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kasir Pintar + Laporan</title>
    <style>
        :root { --primary: #2563eb; --dark: #1e293b; --bg: #f8fafc; --success: #22c55e; --orange: #f59e0b; }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--bg); color: var(--dark); }
        .nav-bar { background: var(--dark); display: flex; justify-content: center; padding: 10px; position: sticky; top: 0; z-index: 100; }
        .nav-bar button { background: transparent; color: white; border: none; padding: 10px 15px; margin: 0 5px; cursor: pointer; border-radius: 5px; font-weight: bold; }
        .nav-bar button.active { background: var(--primary); }
        .view { display: none; padding: 20px; max-width: 1000px; margin: auto; }
        .view.active { display: block; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #cbd5e1; border-radius: 6px; box-sizing: border-box; }
        button.main-btn { width: 100%; background: var(--primary); color: white; border: none; padding: 15px; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .order-card { background: white; border-top: 5px solid var(--orange); padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: var(--dark); color: white; }
    </style>
</head>
<body>

    <div class="nav-bar">
        <button id="btn-kasir" class="active" onclick="checkPass('kasir')">üì± KASIR</button>
        <button id="btn-dapur" onclick="checkPass('dapur')">üë®‚Äçüç≥ DAPUR</button>
        <button id="btn-laporan" onclick="checkPass('laporan')">üìä LAPORAN</button>
    </div>

    <div id="view-kasir" class="view active">
        <div class="card" style="max-width: 400px; margin: auto;">
            <h2>Input Pesanan</h2>
            <input type="number" id="meja" placeholder="Nomor Meja">
            <textarea id="pesanan" rows="4" placeholder="Detail Pesanan..."></textarea>
            <button class="main-btn" onclick="kirimPesanan()">KIRIM KE DAPUR</button>
        </div>
    </div>

    <div id="view-dapur" class="view">
        <h1>Antrean Dapur</h1>
        <div class="grid" id="list-pesanan"></div>
    </div>

    <div id="view-laporan" class="view">
        <h1>Laporan Penjualan (Selesai)</h1>
        <div class="card">
            <table id="tabel-laporan">
                <thead>
                    <tr>
                        <th>Waktu</th>
                        <th>Meja</th>
                        <th>Pesanan</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD8-Ps6ompRiQ7ITKE9nYvOxzR77aL120U",
            authDomain: "kasir-abc5f.firebaseapp.com",
            databaseURL: "https://kasir-abc5f-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "kasir-abc5f",
            storageBucket: "kasir-abc5f.firebasestorage.app",
            messagingSenderId: "442202046937",
            appId: "1:442202046937:web:f55a5871ac7cfbb91159c8"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const PASS_BENAR = "1234"; // GANTI PASSWORD DI SINI

        function checkPass(mode) {
            const input = prompt("Masukkan Password:");
            if (input === PASS_BENAR) {
                switchView(mode);
            } else {
                alert("Password Salah!");
            }
        }

        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-bar button').forEach(b => b.classList.remove('active'));
            document.getElementById('view-' + viewName).classList.add('active');
            document.getElementById('btn-' + viewName).classList.add('active');
        }

        function kirimPesanan() {
            const meja = document.getElementById('meja').value;
            const pesanan = document.getElementById('pesanan').value;
            if (meja && pesanan) {
                database.ref('pesanan').push({
                    meja, item: pesanan, waktu: new Date().toLocaleString()
                }).then(() => {
                    alert("Terkirim!");
                    document.getElementById('pesanan').value = '';
                });
            }
        }

        // Suara Notifikasi
        let lastCount = 0;
        function playSound() {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.frequency.value = 523.25; // Nada C5
            osc.start(); gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 1);
            osc.stop(audioCtx.currentTime + 1);
        }

        // Monitor Dapur
        database.ref('pesanan').on('value', (snapshot) => {
            const list = document.getElementById('list-pesanan');
            list.innerHTML = '';
            const data = snapshot.val();
            const count = data ? Object.keys(data).length : 0;
            if (count > lastCount) playSound();
            lastCount = count;

            if (data) {
                Object.keys(data).forEach(id => {
                    const item = data[id];
                    list.innerHTML += `
                        <div class="order-card">
                            <h2>Meja ${item.meja}</h2>
                            <p>${item.item}</p>
                            <button class="main-btn" style="background:var(--success)" onclick="selesaikan('${id}')">Selesai</button>
                        </div>`;
                });
            }
        });

        function selesaikan(id) {
            database.ref('pesanan/' + id).once('value', (snap) => {
                const data = snap.val();
                // Pindahkan ke Laporan sebelum hapus dari antrean
                database.ref('laporan').push(data);
                database.ref('pesanan/' + id).remove();
            });
        }

        // Monitor Laporan
        database.ref('laporan').on('value', (snapshot) => {
            const tbody = document.querySelector('#tabel-laporan tbody');
            tbody.innerHTML = '';
            const data = snapshot.val();
            if (data) {
                Object.values(data).reverse().forEach(item => {
                    tbody.innerHTML += `<tr><td>${item.waktu}</td><td>${item.meja}</td><td>${item.item}</td></tr>`;
                });
            }
        });
    </script>
</body>
</html>
